# Go gRPC PubSub Service

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç —Å–µ—Ä–≤–∏—Å —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–æ–¥–µ–ª—å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏-–ø–æ–¥–ø–∏—Å–∫–∏ (PubSub) –Ω–∞ Go —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º gRPC.  
–ö–ª–∏–µ–Ω—Ç—ã –º–æ–≥—É—Ç –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è –ø–æ –∫–ª—é—á—É –∏ –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –∫–æ–≥–¥–∞ –¥—Ä—É–≥–∏–µ –ø—É–±–ª–∏–∫—É—é—Ç —Å–æ–±—ã—Ç–∏—è —Å —Ç–µ–º –∂–µ –∫–ª—é—á–æ–º.

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ—Å–Ω–æ–≤—ã–≤–∞–µ—Ç—Å—è –Ω–∞:

- –ß–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ
- –ö–∞–Ω–∞–ª–∞—Ö –∏ –≥–æ—Ä—É—Ç–∏–Ω–∞—Ö
- gRPC API —Å–æ —Å—Ç–∞—Ç—É—Å-–∫–æ–¥–∞–º–∏ (`codes.InvalidArgument`, `codes.Unavailable`, –∏ –¥—Ä.)
- Graceful shutdown
- –ü–æ–¥–∫–ª—é—á–∞–µ–º–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ –±–µ—Ä—É—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è         | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                      | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|--------------------|----------------------------------|------------------------|
| `GRPC_PORT`        | –ü–æ—Ä—Ç –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞       | `50051`                |
| `TEST_GRPC_ADDR1`  | –ê–¥—Ä–µ—Å –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —Ç–µ—Å—Ç–∞ gRPC     | `localhost:50052`      |
| `TEST_GRPC_ADDR2`  | –ê–¥—Ä–µ—Å –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ —Ç–µ—Å—Ç–∞ gRPC     | `localhost:50053`      |

## üöÄ –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–î–ª—è —Ä–∞–±–æ—Ç—ã –∏ —Å–±–æ—Ä–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã:

- **Go** 1.20 –∏–ª–∏ –≤—ã—à–µ
- **Protocol Buffers Compiler** (`protoc`)
- –ü–ª–∞–≥–∏–Ω—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Go-–∫–æ–¥–∞ –∏–∑ `.proto`:

```bash
go install google.golang.org/protobuf/cmd/protoc-gen-go@latest
go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest
```

### üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
go mod tidy
```
### üõ†Ô∏è –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ gRPC-—Å–µ—Ä–≤–µ—Ä–∞
```bash
go run main.go
```

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ :50051. –ü–æ—Ä—Ç –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
GRPC_PORT=50505 go run main.go
```

## üß™ –¢–µ—Å—Ç—ã

–í–∫–ª—é—á–∞—é—Ç:

- –ü—Ä–æ–≤–µ—Ä–∫—É –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã `Publish/Subscribe` –ø–æ gRPC
- –ü—Ä–æ–≤–µ—Ä–∫—É graceful shutdown
- –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã pubsub –ª–æ–≥–∏–∫–∏

–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤:
```bash
go test -v ./...
```

## ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

- **Dependency Injection**: –ø–µ—Ä–µ–¥–∞—á–∞ `subpub` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä gRPC —Å–µ—Ä–≤–µ—Ä–∞
- **Graceful Shutdown**: `os.Signal`, `GracefulStop`
- **Config management**: —á—Ç–µ–Ω–∏–µ –∏–∑ `os.Getenv` —Å –¥–µ—Ñ–æ–ª—Ç–∞–º–∏
- **Structured Logging**: —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–æ–≤, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏–π

## üß† –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ö–ª–∏–µ–Ω—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç –∑–∞–ø—Ä–æ—Å `Subscribe`, —É–∫–∞–∑—ã–≤–∞—è –∫–ª—é—á ‚Äî –ø–æ–¥–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è –ø–æ –Ω–µ–º—É.
2. –õ—é–±–æ–π –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å `Publish`, —É–∫–∞–∑–∞–≤ –∫–ª—é—á –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ.
3. –°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤—Å–µ–º –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–∞–º (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫).
4. –ö–∞–∂–¥—ã–π –ø–æ–¥–ø–∏—Å—á–∏–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –≥–æ—Ä—É—Ç–∏–Ω–µ, –Ω–µ –º–µ—à–∞—è –æ—Å—Ç–∞–ª—å–Ω—ã–º.
5. –°–µ—Ä–≤–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `GracefulStop()` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ —á–µ—Ä–µ–∑ `Close(ctx)`.
6. –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º gRPC `codes`, –∞ –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ç–ª–∞–¥–∫–µ.

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
Go-Practice-VK/
‚îú‚îÄ‚îÄ main.go               # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ config/               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ç–æ—Ä
‚îú‚îÄ‚îÄ subpub/               # –õ–æ–≥–∏–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏
‚îú‚îÄ‚îÄ server/               # gRPC-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
‚îú‚îÄ‚îÄ gen/                  # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ protobuf-—Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ proto/                # –ò—Å—Ö–æ–¥–Ω—ã–π `.proto` —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ test/                 # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏ unit-—Ç–µ—Å—Ç—ã
```

## üìú –ü—Ä–æ—Ç–æ–∫–æ–ª

–§–∞–π–ª `proto/pubsub.proto` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å gRPC —Å–µ—Ä–≤–∏—Å–∞. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è:
```bash
protoc -I proto --go_out=gen --go-grpc_out=gen proto/pubsub.proto
```
